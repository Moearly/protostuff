#summary Existing pojos or ejbs can be protobuf encoded/serialized.
#labels Featured

The *protostuff-runtime* module allows your existing pojos to be written to different formats (protobuf,json, xml, yaml) at runtime.

The key factor is that protostuff does not need a pojo to implement/extend certain classes in order to be serialized.

What this module does is generate a schema at runtime where you can use it and cache it to write and read protobuf-encoded messages.

_Note that you can also hand-code schemas to avoid reflection._

{{{
   Foo foo = new Foo("foo", 1, 3.5);

   // this is lazily created and cached by RuntimeSchema
   // so its safe to call RuntimeSchema.getSchema(Foo.class) over and over
   // The getSchema method is also thread-safe
   Schema<Foo> schema = RuntimeSchema.getSchema(Foo.class);
   
   // protostuff serialize
   byte[] protostuff = ProtostuffIOUtil.toByteArray(foo, schema, LinkedBuffer.allocate(512)); // buffer recommended to be thread-local

   // protostuff deserialize
   Foo f = new Foo();
   ProtostuffIOUtil.mergeFrom(protostuff, f, schema);
   
   // protobuf serialize
   byte[] protobuf = ProtobufIOUtil.toByteArray(foo, schema, LinkedBuffer.allocate(512)); // buffer recommended to be thread-local

   // protobuf deserialize
   Foo f = new Foo();
   ProtobufIOUtil.mergeFrom(protobuf, f, schema);
   
   // json serialize
   boolean numeric = true;
   byte[] json = JsonIOUtil.toByteArray(foo, schema, numeric);

   // json deserialize
   Foo f = new Foo();
   JsonIOUtil.mergeFrom(json, f, schema, numeric);
   
   // xml serialize
   byte[] xml = XmlIOUtil.toByteArray(foo, schema);

   // xml deserialize
   Foo f = new Foo();
   XmlIOUtil.mergeFrom(xml, f, schema);
   
   // yaml serialize
   byte[] yaml = YamlIOUtil.toByteArray(foo, schema, LinkedBuffer.allocate(512)); // buffer recommended to be thread-local
   
}}}

===Reading/Writing from/to streams===
{{{
   Foo foo = new Foo("foo", 1, 3.5);
   
   Schema<Foo> schema = RuntimeSchema.getSchema(Foo.class);

   // protostuff serialize
   ProtostuffIOUtil.writeTo(outputStream, foo, LinkedBuffer.allocate(512)); // buffer recommended to be thread-local
   
   // protostuff deserialize
   Foo f = new Foo();
   ProtostuffIOUtil.mergeFrom(inputStream, f, schema);
   
   // protobuf serialize
   ProtobufIOUtil.writeTo(outputStream, foo, LinkedBuffer.allocate(512)); // buffer recommended to be thread-local
   
   // protobuf deserialize
   Foo f = new Foo();
   ProtobufIOUtil.mergeFrom(inputStream, f, schema);
   
   // json serialize
   boolean numeric = true;
   JsonIOUtil.writeTo(outputStream, foo, schema, numeric);
   
   // json deserialize
   Foo f = new Foo();
   JsonIOUtil.mergeFrom(inputStream, f, schema, numeric);
   
   // xml serialize
   XmlIOUtil.writeTo(outputStream, foo, schema);
   
   // xml deserialize
   Foo f = new Foo();
   XmlIOUtil.mergeFrom(inputStream, f, schema);
   
   // yaml serialize
   YamlIOUtil.writeTo(outputStream, foo, schema, buffer); // buffer recommended to be thread-local

}}}